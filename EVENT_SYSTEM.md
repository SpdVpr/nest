# ğŸ® SystÃ©m udÃ¡lostÃ­ (LAN Party Events)

## Koncept

Aplikace **The Nest** je postavenÃ¡ na konceptu **LAN Party udÃ¡lostÃ­**. KaÅ¾dÃ¡ LAN Party je samostatnÃ¡ udÃ¡lost s:
- **NÃ¡zvem** (napÅ™. "LAN Party - Listopad 2025")
- **Datem zaÄÃ¡tku** a **konce**
- **VlastnÃ­mi hosty** registrovanÃ½mi pro tuto konkrÃ©tnÃ­ udÃ¡lost
- **SpotÅ™ebou produktÅ¯** pÅ™iÅ™azenou k udÃ¡losti

## Workflow

### 1ï¸âƒ£ Admin vytvoÅ™Ã­ novou LAN Party udÃ¡lost
- PÅ™ejde do **Admin â†’ SprÃ¡va eventÅ¯**
- VytvoÅ™Ã­ novÃ½ event s nÃ¡zvem a daty (datum zaÄÃ¡tku a konce)
- Event se automaticky aktivuje (mÅ¯Å¾e bÃ½t aktivnÃ­ jen 1 event souÄasnÄ›)

### 2ï¸âƒ£ HostÃ© se registrujÃ­
- Na **homepage** vidÃ­ nÃ¡zev a datum aktuÃ¡lnÃ­ LAN Party
- RegistrujÃ­ se zadÃ¡nÃ­m jmÃ©na
- Host je pÅ™iÅ™azen k aktuÃ¡lnÄ› aktivnÃ­mu eventu

### 3ï¸âƒ£ HostÃ© sledujÃ­ spotÅ™ebu
- VybÃ­rajÃ­ produkty ze seznamu
- KaÅ¾dÃ¡ spotÅ™eba je zaznamenÃ¡na k aktuÃ¡lnÃ­mu eventu
- VidÃ­ svoji celkovou ÄÃ¡stku za aktuÃ¡lnÃ­ event

### 4ï¸âƒ£ Konec udÃ¡losti
- Admin ukonÄÃ­ aktivnÃ­ event (tlaÄÃ­tko "UkonÄit" v SprÃ¡vÄ› eventÅ¯)
- VytvoÅ™Ã­ novÃ½ event pro pÅ™Ã­Å¡tÃ­ LAN Party
- HostÃ© z pÅ™edchozÃ­ho eventu zÅ¯stÃ¡vajÃ­ v historii

---

## ZobrazenÃ­ udÃ¡lostÃ­ v aplikaci

### ğŸ“± **Homepage (veÅ™ejnÃ¡ strÃ¡nka)**
```
ğŸªº The Nest
SystÃ©m pro sledovÃ¡nÃ­ spotÅ™eby na LAN parties

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“…  LAN Party - Listopad 2025      â”‚
â”‚     30.10.2025 - 2.11.2025          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Jsem novÃ½ host]  [UÅ¾ jsem tady]
```

### ğŸ‘¤ **Registrace hosta**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“…  LAN Party - Listopad 2025      â”‚
â”‚     30.10.2025 - 2.11.2025          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NovÃ½ host
Zadej svÃ© jmÃ©no a zaÄni sledovat spotÅ™ebu

[Input: Tvoje jmÃ©no]
[VytvoÅ™it ÃºÄet]
```

### ğŸ‘¥ **VÃ½bÄ›r z existujÃ­cÃ­ch hostÅ¯**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“…  LAN Party - Listopad 2025      â”‚
â”‚     30.10.2025 - 2.11.2025          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Vyber se ze seznamu

[Jan]  [Petr]  [Marie]  [TomÃ¡Å¡]
...
```

### ğŸ›¡ï¸ **Admin Dashboard**
```
ğŸªº The Nest - Admin

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AktuÃ¡lnÃ­ event                          ğŸ“…  â”‚
â”‚  LAN Party - Listopad 2025                   â”‚
â”‚  30.10.2025 - 2.11.2025                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HostÃ©   â”‚ â”‚Produkty â”‚ â”‚ Obrat   â”‚
â”‚   20    â”‚ â”‚   15    â”‚ â”‚ 2500 KÄ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸª **SprÃ¡va eventÅ¯ (Admin)**
```
SprÃ¡va eventÅ¯                    [+ NovÃ½ event]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NÃ¡zev                  â”‚ ZaÄÃ¡tek    â”‚ Konec      â”‚Statusâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ LAN Party - Listopad   â”‚ 30.10.2025 â”‚ 2.11.2025  â”‚âœ… AktivnÃ­â”‚
â”‚ LAN Party - Å˜Ã­jen      â”‚ 28.9.2025  â”‚ 30.9.2025  â”‚âŒ NeaktivnÃ­â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Pravidla systÃ©mu

### âœ… **Pouze jeden aktivnÃ­ event**
- V jednu chvÃ­li mÅ¯Å¾e bÃ½t aktivnÃ­ pouze **1 event**
- PÅ™i aktivaci novÃ©ho eventu se pÅ™edchozÃ­ automaticky deaktivuje
- DatabÃ¡zovÃ½ constraint zajiÅ¡Å¥uje toto pravidlo

### ğŸ“… **Data udÃ¡lostÃ­**
- **Datum zaÄÃ¡tku**: PovinnÃ© (vÃ½chozÃ­ = NOW())
- **Datum konce**: VolitelnÃ© (lze vyplnit pozdÄ›ji)
- FormÃ¡t: `datetime-local` input v admin rozhranÃ­

### ğŸ‘¥ **HostÃ©**
- KaÅ¾dÃ½ host je pÅ™iÅ™azen k **jednomu eventu** (session_id)
- HostÃ© z jednoho eventu nevidÃ­ hosty z jinÃ©ho eventu
- Host mÅ¯Å¾e mÃ­t stejnÃ© jmÃ©no v rÅ¯znÃ½ch eventech (jsou to rÅ¯znÃ© zÃ¡znamy)

### ğŸ›’ **SpotÅ™eba**
- KaÅ¾dÃ½ zÃ¡znam spotÅ™eby mÃ¡:
  - `guest_id` - kdo spotÅ™eboval
  - `product_id` - co spotÅ™eboval
  - `session_id` - pÅ™i jakÃ©m eventu
  - `quantity` - kolik kusÅ¯
  - `consumed_at` - kdy

---

## API Endpointy

### **VeÅ™ejnÃ© API**
```typescript
GET /api/sessions/active
// VrÃ¡tÃ­ aktuÃ¡lnÄ› aktivnÃ­ event s daty

Response:
{
  session: {
    id: "uuid",
    name: "LAN Party - Listopad 2025",
    start_date: "2025-10-30T18:00:00Z",
    end_date: "2025-11-02T12:00:00Z",
    is_active: true
  }
}
```

### **Admin API**
```typescript
POST /api/admin/sessions
// VytvoÅ™Ã­ novÃ½ event
Body: {
  name: string,
  start_date?: string (ISO),
  end_date?: string (ISO)
}

GET /api/admin/sessions
// VrÃ¡tÃ­ vÅ¡echny eventy (seÅ™azenÃ© podle data)

PATCH /api/admin/sessions/:id
// Aktivuje/deaktivuje event
Body: { is_active: boolean }
```

---

## DatabÃ¡zovÃ© schÃ©ma

### **sessions** tabulka
```sql
CREATE TABLE sessions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    start_date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    end_date TIMESTAMP WITH TIME ZONE,
    is_active BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Constraint: pouze jeden aktivnÃ­ event
CREATE UNIQUE INDEX unique_active_session 
ON sessions(is_active) 
WHERE is_active = true;
```

### **guests** tabulka
```sql
CREATE TABLE guests (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    session_id UUID NOT NULL REFERENCES sessions(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    is_active BOOLEAN DEFAULT true
);
```

---

## TypickÃ½ scÃ©nÃ¡Å™ pouÅ¾itÃ­

### ğŸ“† **PÅ™Ã­prava na LAN Party**
1. Admin se pÅ™ihlÃ¡sÃ­ do admin rozhranÃ­
2. PÅ™ejde do **SprÃ¡va eventÅ¯**
3. Klikne **+ NovÃ½ event**
4. VyplnÃ­:
   - NÃ¡zev: "LAN Party - Prosinec 2025"
   - Datum zaÄÃ¡tku: 15.12.2025 18:00
   - Datum konce: 17.12.2025 12:00
5. Klikne **VytvoÅ™it event**
6. Event se automaticky aktivuje

### ğŸ® **BÄ›hem LAN Party**
1. HostÃ© pÅ™ichÃ¡zejÃ­ a registrujÃ­ se na homepage
2. KaÅ¾dÃ½ vidÃ­ nÃ¡zev aktuÃ¡lnÃ­ho eventu: "LAN Party - Prosinec 2025"
3. HostÃ© pÅ™idÃ¡vajÃ­ produkty do spotÅ™eby
4. Admin sleduje statistiky na dashboardu

### ğŸ **Po skonÄenÃ­**
1. Admin pÅ™ejde do **SprÃ¡va eventÅ¯**
2. U aktuÃ¡lnÃ­ho eventu klikne **UkonÄit**
3. Event se deaktivuje, ale data zÅ¯stÃ¡vajÃ­ v databÃ¡zi
4. Pro pÅ™Ã­Å¡tÃ­ LAN Party se vytvoÅ™Ã­ novÃ½ event

---

## BudoucÃ­ vylepÅ¡enÃ­

- [ ] **Archivace eventÅ¯** - zobrazenÃ­ statistik minulÃ½ch eventÅ¯
- [ ] **Export dat per event** - staÅ¾enÃ­ CSV pro konkrÃ©tnÃ­ LAN Party
- [ ] **PorovnÃ¡nÃ­ eventÅ¯** - statistiky mezi rÅ¯znÃ½mi LAN parties
- [ ] **AutomatickÃ© ukonÄenÃ­** - event se automaticky ukonÄÃ­ podle end_date
- [ ] **Email notifikace** - upozornÄ›nÃ­ hostÅ¯m pÅ™ed zaÄÃ¡tkem eventu
- [ ] **QR kÃ³dy** - generovÃ¡nÃ­ QR kÃ³dÅ¯ pro rychlÃ© pÅ™ihlÃ¡Å¡enÃ­ hostÅ¯

---

## Å˜eÅ¡enÃ­ problÃ©mÅ¯

### âŒ **"NenÃ­ aktivnÃ­ Å¾Ã¡dnÃ½ event"**
**ProblÃ©m:** Homepage nebo registrace zobrazuje chybu.

**Å˜eÅ¡enÃ­:**
1. PÅ™ihlaÅ¡ se jako admin
2. PÅ™ejdi do **SprÃ¡va eventÅ¯**
3. VytvoÅ™ novÃ½ event nebo aktivuj existujÃ­cÃ­

### âŒ **"No active session found"**
**ProblÃ©m:** API vracÃ­ 404 pÅ™i registraci hosta.

**Å˜eÅ¡enÃ­:**
SpusÅ¥ setup skript:
```bash
npm run setup
```

Nebo ruÄnÄ› v Supabase SQL Editor:
```sql
INSERT INTO sessions (name, is_active, start_date)
VALUES ('PrvnÃ­ LAN Party', true, NOW());
```

---

## TechnickÃ© detaily

### **AutomatickÃ© vypnutÃ­ pÅ™edchozÃ­ho eventu**
```sql
CREATE OR REPLACE FUNCTION ensure_single_active_session()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.is_active = true THEN
        UPDATE sessions 
        SET is_active = false 
        WHERE id != NEW.id AND is_active = true;
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

Tento trigger zajiÅ¡Å¥uje, Å¾e pÅ™i aktivaci novÃ©ho eventu se vÅ¡echny ostatnÃ­ automaticky deaktivujÃ­.

---

MÃ¡Å¡ otÃ¡zky? NÄ›co nefunguje? NapiÅ¡ mi! ğŸš€